!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define("ng-textflow",["exports","@angular/core","rxjs","rxjs/operators","@angular/common"],t):t(e["ng-textflow"]={},e.ng.core,e.rxjs,e.rxjs.operators,e.ng.common)}(this,function(e,r,n,i,t){"use strict";var s=function(){function t(e,t){this.renderer=e,this.elementRef=t,this._heading="",this._isVisible=!1,this._pageNumberAtTop=!1,this.showHeading=!0,this.hostPosition="",this.hostVisibility="hidden",this.numberStyle={},this.headingStyle={},this.nodeStyle={},this.hostStyle={},this.defaultStyles={hostStyle:{},contentStyle:{height:"9em",width:"200px",fontSize:"11px",wordSpacing:"2px",textAlign:"justify",lineHeight:"1.1em",leftAlignLast:"justified"},headingStyle:{"font-size":"14px",height:"25px"},numberStyle:{"font-size":"10px"}},this.overflowSubject=new n.Subject,this.overflow=this.overflowSubject,this.adding=!1,this.finishing=!1,this.trimming=!1,this.count=100}return t.prototype.ngOnInit=function(){var t=this;this.dummyText=this.text,this.trimming=!0,this.changes=new MutationObserver(function(e){return t.manageState()}),this.changes.observe(this.dummyDivRef.nativeElement,{attributes:!0,childList:!0,characterData:!0}),setTimeout(function(){99<=t.index?setTimeout(function(){return t.manageState()},200):t.manageState()})},Object.defineProperty(t.prototype,"dummyText",{get:function(){return this.dummyDivRef.nativeElement.textContent},set:function(e){this.dummyDivRef.nativeElement.textContent=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVisible",{get:function(){return this._isVisible},set:function(e){this._isVisible=e,this.hostVisibility="visible"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"index",{get:function(){return this._index},set:function(e){var t=this;this.pageNumber=100-e,setTimeout(function(){t._index=Math.abs(e),t.renderer.setStyle(t.elementRef.nativeElement,"z-index",e)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return parseInt(this.mask.nativeElement.style.width.replace(/\D/g,""))},set:function(e){this.renderer.setStyle(this.mask.nativeElement,"width",e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heading",{get:function(){return this._heading},set:function(e){this._heading=this._heading=""===e?" ":e,t.headingChangedSubject.next()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageNumberAtTop",{get:function(){return this._pageNumberAtTop},set:function(e){this._pageNumberAtTop=e,this.numberStyle["padding-bottom"]=this.pageNumberAtTop?"0px":this.padding+"px",this.numberStyle["padding-top"]=this.pageNumberAtTop?this.padding+"px":"0px"},enumerable:!0,configurable:!0}),t.prototype.applyStyle=function(e){this.nodeStyle=e.contentStyle?this.convertStyleToPx(e.contentStyle):this.convertStyleToPx(this.defaultStyles.contentStyle),this.numberStyle=e.numberStyle?e.numberStyle:this.defaultStyles.numberStyle,this.hostStyle=e.hostStyle?e.hostStyle:this.defaultStyles.hostStyle,""<this.numberStyle.padding?this.padding=parseInt(this.numberStyle.padding.replace(/\D/g,"")):this.padding=16,this.numberStyle["padding-left"]=parseInt(this.nodeStyle.width.replace(/\D/g,""))/2+"px",this.headingStyle=e.headingStyle?e.headingStyle:this.defaultStyles.headingStyle,this.headingStyle.width=this.nodeStyle.width,this.renderer.setStyle(this.elementRef.nativeElement,"width",e.width),this.nodeStyle.overflow="hidden",this.width=parseInt(this.nodeStyle.width.replace(/\D/g,"")),this.isOverlaid&&(this.hostPosition="absolute")},t.prototype.convertStyleToPx=function(e){var t=e,i=(t.fontSize.replace(/[\d\.]/g,""),parseFloat(t.fontSize.replace(/[A-Za-z]/g,"")));for(var n in t){if(0<t[n].indexOf("em"))switch(t[n].replace(/[\d\.]/g,"")){case"em":var s=parseFloat(t[n].replace(/[A-Za-z]/g,""));t[n]=Math.round(s*i)+"px"}}return t},t.prototype.parseLineHeight=function(){var e=this.textDivRef.nativeElement.style.lineHeight;return parseInt(e.replace(/\D/g,""))},t.prototype.compareDivs=function(){var e=this.parseLineHeight(),t=Math.floor(this.dummyDivRef.nativeElement.clientHeight/e);return{lines:t,diffLines:t-Math.floor(this.textDivRef.nativeElement.clientHeight/e),words:this.dummyText.split(" ").length}},t.prototype.manageState=function(){this.count--<=0&&(this.trimming=!1,this.adding=!1,this.finishing=!1,console.log("ERROR - loop count > 100")),this.trimming?this.trim():this.adding?this.addword():this.finishing&&this.finish()},t.prototype.trim=function(){var e=this.compareDivs(),t=Math.floor(e.words/e.lines)*(e.diffLines+1);0<t?this.dummyText=this.dummyText.split(" ").slice(0,e.words-t).join(" "):(this.trimming=!1,this.adding=!0,this.addword())},t.prototype.addword=function(){var e=this.compareDivs();e.diffLines<=-1?this.dummyText.length<this.text.length?this.dummyText=this.dummyText+" "+this.text.split(" ")[e.words]:(this.renderer.setStyle(this.textDivRef.nativeElement,"textAlignLast","left"),t.finishedSubject.next()):(this.dummyText=this.dummyText.split(" ").slice(0,e.words-1).join(" "),this.adding=!1,this.finishing=!0)},t.prototype.finish=function(){this.compareDivs(),this.dummyText.split(" ");var e=this.text.split(" ").slice(this.dummyText.split(" ").length).join(" ");this.text=this.dummyText,this.finishing=!1,this.overflowSubject.next(e)},t.finishedSubject=new n.Subject,t.finished=t.finishedSubject,t.headingChangedSubject=new n.Subject,t.headingChanged=t.headingChangedSubject.pipe(i.debounce(function(){return n.interval(10)})),t.decorators=[{type:r.Component,args:[{selector:"app-node",template:'\n    <div class="mask" #maskTag [ngStyle]="hostStyle">\n      <div *ngIf="showPageNumber && pageNumberAtTop" [ngStyle]="numberStyle">\n        {{pageNumber}}\n      </div>  \n      <div *ngIf="showHeading" [ngStyle]="headingStyle">\n        {{heading}}\n      </div>\n      <div #textref [ngStyle]="nodeStyle" class="content">\n        {{text}}\n        <div #dummy class="dummy" >{{ dummyText }}</div>\n      </div>\n      <div *ngIf="showPageNumber && !pageNumberAtTop" [ngStyle]="numberStyle">\n        {{pageNumber}}\n      </div>\n    </div>\n',styles:["\n    .content {\n      position: relative;\n      text-align-last: justify;\n      cursor: default;\n    }\n    .mask {\n      display block;\n      overflow: hidden;\n    }\n    :host {\n      display: block;\n      overflow: hidden;\n      user-select: none;\n    }\n    .dummy {\n      position: absolute;\n      background-color: rgba(155, 255, 155, 0.4);\n      left: 0px;\n      top: 0px;\n      visibility: hidden;\n    }\n  "]}]}],t.ctorParameters=function(){return[{type:r.Renderer2},{type:r.ElementRef}]},t.propDecorators={textDivRef:[{type:r.ViewChild,args:["textref"]}],dummyDivRef:[{type:r.ViewChild,args:["dummy"]}],mask:[{type:r.ViewChild,args:["maskTag"]}],hostPosition:[{type:r.HostBinding,args:["style.position"]}],hostVisibility:[{type:r.HostBinding,args:["style.visibility"]}]},t}(),o=function(){function e(e,t){var i=this;this.injector=e,this.resolver=t,this.nodeList=new Array,this.firstOnTop=!0,this.overFlowSubscriptions=[],this.nodesSubject=new n.BehaviorSubject(null),this.nodes=this.nodesSubject,this.nodeFactory=this.resolver.resolveComponentFactory(s),this.finishedSubscription=s.finished.subscribe(function(){i.nodeList.forEach(function(e){return e.isVisible=!0}),i.headingChangedSubscription=s.headingChanged.subscribe(function(){var t=0;i.nodeList.forEach(function(e){t=e.heading<=" "?t+1:t-1}),i.nodeList.forEach(function(e){e.showHeading=t!==i.nodeList.length})}),i.nodesSubject.next(i.nodeList)})}return e.prototype.clearNodes=function(){this.nodeList=[]},e.prototype.createFlow=function(e,t,i,n,s){var o=this,r=this.createNode(e,t,i,n,s);this.overFlowSubscriptions.push(r.overflow.subscribe(function(e){e&&o.createFlow(e,t,i,n,s)}))},e.prototype.createNode=function(e,t,i,n,s){var o;return(o=t||t instanceof r.ViewContainerRef?t.createComponent(this.nodeFactory,undefined,this.injector):this.nodeFactory.create(this.injector)).instance.isOverlaid=s,o.instance.showPageNumber=n,o.instance.text=e,i&&o.instance.applyStyle(i),this.nodeList.push(o.instance),o.instance.index=this.firstOnTop?100-this.nodeList.length:this.nodeList.length,o.instance},e.prototype.ngOnDestroy=function(){this.finishedSubscription.unsubscribe(),this.headingChangedSubscription.unsubscribe(),this.overFlowSubscriptions.forEach(function(e){e.unsubscribe()})},e.decorators=[{type:r.Injectable}],e.ctorParameters=function(){return[{type:r.Injector},{type:r.ComponentFactoryResolver}]},e}(),a=function(){function e(e){this.nodeService=e,this.nodeStyles={},this.firstOnTop=!0,e.firstOnTop=this.firstOnTop}return Object.defineProperty(e.prototype,"content",{get:function(){return this._content},set:function(e){this._content=e,this.nodeService.clearNodes(),this.viewContainer.clear(),this.nodeService.createFlow(this.content,this.viewContainer,this.nodeStyles,this.showPageNumbers,this.isOverlaid)},enumerable:!0,configurable:!0}),e.decorators=[{type:r.Component,args:[{selector:"ng-textflow",template:" \n    <ng-container #viewContainer></ng-container>\n  "}]}],e.ctorParameters=function(){return[{type:o}]},e.propDecorators={viewContainer:[{type:r.ViewChild,args:["viewContainer",{read:r.ViewContainerRef}]}],nodeStyles:[{type:r.Input}],firstOnTop:[{type:r.Input}],showPageNumbers:[{type:r.Input}],isOverlaid:[{type:r.Input}],content:[{type:r.Input}]},e}(),h=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[o]}},e.decorators=[{type:r.NgModule,args:[{imports:[t.CommonModule],declarations:[a,s],entryComponents:[s],exports:[a]}]}],e}();e.NgTextflowModule=h,e.NodeComponent=s,e.CreateFlowService=o,e.Éµa=a,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ng-textflow.umd.min.js.map