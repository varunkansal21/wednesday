/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Injectable, Injector, ComponentFactoryResolver, ViewContainerRef } from '@angular/core';
import { NodeComponent } from './node.component';
import { BehaviorSubject } from 'rxjs';
var CreateFlowService = /** @class */ (function () {
    function CreateFlowService(injector, resolver) {
        var _this = this;
        this.injector = injector;
        this.resolver = resolver;
        this.nodeList = new Array();
        this.firstOnTop = true;
        this.overFlowSubscriptions = [];
        this.nodesSubject = new BehaviorSubject(null);
        this.nodes = /** @type {?} */ (this.nodesSubject);
        this.nodeFactory = this.resolver.resolveComponentFactory(NodeComponent);
        // When all nodes are finished generating, do some housework.
        this.finishedSubscription = NodeComponent.finished.subscribe(function () {
            _this.nodeList.forEach(function (node) { return node.isVisible = true; }); // Make all visible once complete.
            // If headings are modified externally, then update sibling nodes to maintain consistent formating.
            // If headings are modified externally, then update sibling nodes to maintain consistent formating.
            _this.headingChangedSubscription = NodeComponent.headingChanged.subscribe(function () {
                /** @type {?} */
                var count = 0;
                _this.nodeList.forEach(function (node) {
                    count = node.heading <= ' ' ? count + 1 : count - 1;
                });
                // Loop again to update the visibility of the headings.
                // Loop again to update the visibility of the headings.
                _this.nodeList.forEach(function (node) {
                    node.showHeading = count === _this.nodeList.length ? false : true;
                });
            });
            // Make list of nodes available once all are complete.
            // Make list of nodes available once all are complete.
            _this.nodesSubject.next(_this.nodeList);
        });
    }
    /**
     * @return {?}
     */
    CreateFlowService.prototype.clearNodes = /**
     * @return {?}
     */
    function () {
        this.nodeList = [];
    };
    // This will kick off a process that generates a node every time a generated node is too full and overflows with text.
    /**
     * @param {?} textPassage
     * @param {?} location
     * @param {?} style
     * @param {?} showPageNumbers
     * @param {?} isOverlaid
     * @return {?}
     */
    CreateFlowService.prototype.createFlow = /**
     * @param {?} textPassage
     * @param {?} location
     * @param {?} style
     * @param {?} showPageNumbers
     * @param {?} isOverlaid
     * @return {?}
     */
    function (textPassage, location, style, showPageNumbers, isOverlaid) {
        var _this = this;
        /** @type {?} */
        var node = this.createNode(textPassage, location, style, showPageNumbers, isOverlaid);
        // Create a new node if there is any overflow text from last node generated.
        // Last node will know when it is the last one, and will
        this.overFlowSubscriptions.push(node.overflow.subscribe(function (overflowText) {
            if (overflowText) {
                _this.createFlow(overflowText, location, style, showPageNumbers, isOverlaid);
            }
        }));
    };
    /**
     * @param {?} content
     * @param {?=} location
     * @param {?=} style
     * @param {?=} showPageNumbers
     * @param {?=} isOverlaid
     * @return {?}
     */
    CreateFlowService.prototype.createNode = /**
     * @param {?} content
     * @param {?=} location
     * @param {?=} style
     * @param {?=} showPageNumbers
     * @param {?=} isOverlaid
     * @return {?}
     */
    function (content, location, style, showPageNumbers, isOverlaid) {
        /** @type {?} */
        var nodeRef;
        if (location || location instanceof ViewContainerRef) {
            nodeRef = location.createComponent(this.nodeFactory, undefined, this.injector);
        }
        else {
            nodeRef = this.nodeFactory.create(this.injector);
        }
        // Update the node
        nodeRef.instance.isOverlaid = isOverlaid;
        nodeRef.instance.showPageNumber = showPageNumbers;
        nodeRef.instance.text = content;
        if (style) {
            nodeRef.instance.applyStyle(style);
        }
        // Add node to list of nodes and update its index value.
        this.nodeList.push(nodeRef.instance);
        nodeRef.instance.index = this.firstOnTop ? 100 - this.nodeList.length : this.nodeList.length;
        return nodeRef.instance;
    };
    // Tidy up subscriptions.
    /**
     * @return {?}
     */
    CreateFlowService.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.finishedSubscription.unsubscribe();
        this.headingChangedSubscription.unsubscribe();
        this.overFlowSubscriptions.forEach(function (subscription) {
            subscription.unsubscribe();
        });
    };
    CreateFlowService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    CreateFlowService.ctorParameters = function () { return [
        { type: Injector },
        { type: ComponentFactoryResolver }
    ]; };
    return CreateFlowService;
}());
export { CreateFlowService };
if (false) {
    /** @type {?} */
    CreateFlowService.prototype.nodeList;
    /** @type {?} */
    CreateFlowService.prototype.nodeFactory;
    /** @type {?} */
    CreateFlowService.prototype.firstOnTop;
    /** @type {?} */
    CreateFlowService.prototype.finishedSubscription;
    /** @type {?} */
    CreateFlowService.prototype.headingChangedSubscription;
    /** @type {?} */
    CreateFlowService.prototype.overFlowSubscriptions;
    /** @type {?} */
    CreateFlowService.prototype.nodesSubject;
    /** @type {?} */
    CreateFlowService.prototype.nodes;
    /** @type {?} */
    CreateFlowService.prototype.injector;
    /** @type {?} */
    CreateFlowService.prototype.resolver;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLWZsb3cuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLXRleHRmbG93LyIsInNvdXJjZXMiOlsibmctdGV4dGZsb3cvY3JlYXRlLWZsb3cuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsd0JBQXdCLEVBQzVCLGdCQUFnQixFQUEyQixNQUFNLGVBQWUsQ0FBQztBQUM1RixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDakQsT0FBTyxFQUFFLGVBQWUsRUFBcUMsTUFBTSxNQUFNLENBQUM7O0lBaUJ4RSwyQkFBb0IsUUFBa0IsRUFBVSxRQUFrQztRQUFsRixpQkF3QkM7UUF4Qm1CLGFBQVEsR0FBUixRQUFRLENBQVU7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUEwQjt3QkFiOUMsSUFBSSxLQUFLLEVBQWlCOzBCQUV4QyxJQUFJO3FDQUtzQixFQUFFOzRCQUdELElBQUksZUFBZSxDQUFrQixJQUFJLENBQUM7dUNBQ3RELElBQUksQ0FBQyxZQUEyQztRQUduRixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsdUJBQXVCLENBQUMsYUFBYSxDQUFDLENBQUM7O1FBR3hFLElBQUksQ0FBQyxvQkFBb0IsR0FBSSxhQUFhLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQztZQUM1RCxLQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxVQUFBLElBQUksSUFBSyxPQUFBLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxFQUFyQixDQUFxQixDQUFDLENBQUM7O1lBR3RELEFBREEsbUdBQW1HO1lBQ25HLEtBQUksQ0FBQywwQkFBMEIsR0FBRyxhQUFhLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQzs7Z0JBRXZFLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztnQkFDZCxLQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxVQUFB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dUNBQVc7OztJQUFYO1FBQ0UsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3hDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM5QyxJQUFJLENBQUMscUJBQXFCLENBQUMsT0FBTyxDQUFDLFVBQUEsWUFBWTtZQUM3QyxZQUFZLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDNUIsQ0FBQyxDQUFDO0tBQ0o7O2dCQWxHRixVQUFVOzs7O2dCQUxVLFFBQVE7Z0JBQUUsd0JBQXdCOzs0QkFBdkQ7O1NBTWEsaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0b3IsIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgICAgICAgQ29tcG9uZW50RmFjdG9yeSwgVmlld0NvbnRhaW5lclJlZiwgQ29tcG9uZW50UmVmLCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTm9kZUNvbXBvbmVudCB9IGZyb20gJy4vbm9kZS5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIFN1YmplY3QsIE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgQ3JlYXRlRmxvd1NlcnZpY2UgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xyXG4gIHByaXZhdGUgbm9kZUxpc3Q6IE5vZGVDb21wb25lbnRbXSA9IG5ldyBBcnJheTxOb2RlQ29tcG9uZW50PigpO1xyXG4gIHByaXZhdGUgbm9kZUZhY3Rvcnk6IENvbXBvbmVudEZhY3Rvcnk8Tm9kZUNvbXBvbmVudD47XHJcbiAgZmlyc3RPblRvcDogYm9vbGVhbiA9IHRydWU7XHJcblxyXG4gIC8vIFN1YnNjcmlwdGlvbnNcclxuICBwcml2YXRlIGZpbmlzaGVkU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247IC8vIEZvciB3aGVuIHRoZSBub2RlcyBhcmUgY29tcGxldGUuXHJcbiAgcHJpdmF0ZSBoZWFkaW5nQ2hhbmdlZFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uOyAvLyBGb3Igd2hlbiB0aGUgaGVhZGluZyBpcyBleHRlcm5hbGx5IGNoYW5nZWQuXHJcbiAgcHJpdmF0ZSBvdmVyRmxvd1N1YnNjcmlwdGlvbnM6IFN1YnNjcmlwdGlvbltdID0gW107IC8vIER1cmluZyBnZW5lcmF0aW9uIG9mIG5vZGVzLCBmaXJlcyB3aGVuIHRoZXJlIGFyZSBtb3JlIG5vZGVzIHRvIGdlbmVyYXRlLlxyXG5cclxuICAvLyBQcm92aWRlIGFuIGFycmF5IG9mIG5vZGVzIG9uY2UgdGhlIGdlbmVyYXRpb24gaXMgY29tcGxldGUuXHJcbiAgcHJpdmF0ZSBub2Rlc1N1YmplY3Q6IFN1YmplY3Q8Tm9kZUNvbXBvbmVudFtdPiA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Tm9kZUNvbXBvbmVudFtdPihudWxsKTtcclxuICBub2RlczogT2JzZXJ2YWJsZTxOb2RlQ29tcG9uZW50W10+ID0gdGhpcy5ub2Rlc1N1YmplY3QgYXMgT2JzZXJ2YWJsZTxOb2RlQ29tcG9uZW50W10+O1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluamVjdG9yOiBJbmplY3RvciwgcHJpdmF0ZSByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyKSB7XHJcbiAgICB0aGlzLm5vZGVGYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShOb2RlQ29tcG9uZW50KTtcclxuICAgIFxyXG4gICAgLy8gV2hlbiBhbGwgbm9kZXMgYXJlIGZpbmlzaGVkIGdlbmVyYXRpbmcsIGRvIHNvbWUgaG91c2V3b3JrLlxyXG4gICAgdGhpcy5maW5pc2hlZFN1YnNjcmlwdGlvbiA9ICBOb2RlQ29tcG9uZW50LmZpbmlzaGVkLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgIHRoaXMubm9kZUxpc3QuZm9yRWFjaChub2RlID0+ICBub2RlLmlzVmlzaWJsZSA9IHRydWUpOyAvLyBNYWtlIGFsbCB2aXNpYmxlIG9uY2UgY29tcGxldGUuXHJcblxyXG4gICAgICAvLyBJZiBoZWFkaW5ncyBhcmUgbW9kaWZpZWQgZXh0ZXJuYWxseSwgdGhlbiB1cGRhdGUgc2libGluZyBub2RlcyB0byBtYWludGFpbiBjb25zaXN0ZW50IGZvcm1hdGluZy5cclxuICAgICAgdGhpcy5oZWFkaW5nQ2hhbmdlZFN1YnNjcmlwdGlvbiA9IE5vZGVDb21wb25lbnQuaGVhZGluZ0NoYW5nZWQuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAvLyBMb29wIG9uY2UgdG8gc2VlIGlmIGFsbCBhcmUgZW1wdHkuXHJcbiAgICAgICAgbGV0IGNvdW50ID0gMDtcclxuICAgICAgICB0aGlzLm5vZGVMaXN0LmZvckVhY2gobm9kZSA9PiB7IFxyXG4gICAgICAgICAgY291bnQgPSBub2RlLmhlYWRpbmcgPD0gJyAnID8gY291bnQgKyAxIDogY291bnQgLSAxO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBMb29wIGFnYWluIHRvIHVwZGF0ZSB0aGUgdmlzaWJpbGl0eSBvZiB0aGUgaGVhZGluZ3MuXHJcbiAgICAgICAgdGhpcy5ub2RlTGlzdC5mb3JFYWNoKG5vZGUgPT4ge1xyXG4gICAgICAgICAgbm9kZS5zaG93SGVhZGluZyA9IGNvdW50ID09PSB0aGlzLm5vZGVMaXN0Lmxlbmd0aCA/IGZhbHNlIDogdHJ1ZTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBNYWtlIGxpc3Qgb2Ygbm9kZXMgYXZhaWxhYmxlIG9uY2UgYWxsIGFyZSBjb21wbGV0ZS5cclxuICAgICAgdGhpcy5ub2Rlc1N1YmplY3QubmV4dCh0aGlzLm5vZGVMaXN0KTtcclxuICAgIH0pO1xyXG4gIH0gXHJcblxyXG4gIGNsZWFyTm9kZXMoKSB7XHJcbiAgICB0aGlzLm5vZGVMaXN0ID0gW107XHJcbiAgfVxyXG5cclxuICAvLyBUaGlzIHdpbGwga2ljayBvZmYgYSBwcm9jZXNzIHRoYXQgZ2VuZXJhdGVzIGEgbm9kZSBldmVyeSB0aW1lIGEgZ2VuZXJhdGVkIG5vZGUgaXMgdG9vIGZ1bGwgYW5kIG92ZXJmbG93cyB3aXRoIHRleHQuXHJcbiAgY3JlYXRlRmxvdyh0ZXh0UGFzc2FnZTogc3RyaW5nLCBcclxuICAgICAgICAgICAgIGxvY2F0aW9uOiBWaWV3Q29udGFpbmVyUmVmLCBcclxuICAgICAgICAgICAgIHN0eWxlOiBhbnksIFxyXG4gICAgICAgICAgICAgc2hvd1BhZ2VOdW1iZXJzOiBib29sZWFuLCBcclxuICAgICAgICAgICAgIGlzT3ZlcmxhaWQ6IGJvb2xlYW4pIHtcclxuXHJcbiAgICBsZXQgbm9kZTogTm9kZUNvbXBvbmVudCA9IHRoaXMuY3JlYXRlTm9kZSh0ZXh0UGFzc2FnZSwgbG9jYXRpb24sIHN0eWxlLCBzaG93UGFnZU51bWJlcnMsIGlzT3ZlcmxhaWQpO1xyXG4gICAgXHJcbiAgICAvLyBDcmVhdGUgYSBuZXcgbm9kZSBpZiB0aGVyZSBpcyBhbnkgb3ZlcmZsb3cgdGV4dCBmcm9tIGxhc3Qgbm9kZSBnZW5lcmF0ZWQuXHJcbiAgICAvLyBMYXN0IG5vZGUgd2lsbCBrbm93IHdoZW4gaXQgaXMgdGhlIGxhc3Qgb25lLCBhbmQgd2lsbCBcclxuICAgIHRoaXMub3ZlckZsb3dTdWJzY3JpcHRpb25zLnB1c2gobm9kZS5vdmVyZmxvdy5zdWJzY3JpYmUob3ZlcmZsb3dUZXh0ID0+IHtcclxuICAgICAgaWYgKG92ZXJmbG93VGV4dCkge1xyXG4gICAgICAgIHRoaXMuY3JlYXRlRmxvdyhvdmVyZmxvd1RleHQsIGxvY2F0aW9uLCBzdHlsZSwgc2hvd1BhZ2VOdW1iZXJzLCBpc092ZXJsYWlkKTtcclxuICAgICAgfVxyXG4gICAgfSkpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVOb2RlKGNvbnRlbnQ6IHN0cmluZyxcclxuICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24/OiBWaWV3Q29udGFpbmVyUmVmLCBcclxuICAgICAgICAgICAgICAgICAgICAgc3R5bGU/OiBhbnksIHNob3dQYWdlTnVtYmVycz86IFxyXG4gICAgICAgICAgICAgICAgICAgICBib29sZWFuLCBpc092ZXJsYWlkPzogYm9vbGVhbik6IE5vZGVDb21wb25lbnQge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgLy8gR2VuZXJhdGUgdGhlIG5vZGUgd2l0aCB0aGUgbm9kZUZhY3RvcnkuXHJcbiAgICBsZXQgbm9kZVJlZjogQ29tcG9uZW50UmVmPE5vZGVDb21wb25lbnQ+O1xyXG4gICAgaWYgKGxvY2F0aW9uIHx8IGxvY2F0aW9uIGluc3RhbmNlb2YgVmlld0NvbnRhaW5lclJlZikge1xyXG4gICAgICBub2RlUmVmID0gbG9jYXRpb24uY3JlYXRlQ29tcG9uZW50KHRoaXMubm9kZUZhY3RvcnksIHVuZGVmaW5lZCwgdGhpcy5pbmplY3Rvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBub2RlUmVmID0gdGhpcy5ub2RlRmFjdG9yeS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFVwZGF0ZSB0aGUgbm9kZVxyXG4gICAgbm9kZVJlZi5pbnN0YW5jZS5pc092ZXJsYWlkID0gaXNPdmVybGFpZDtcclxuICAgIG5vZGVSZWYuaW5zdGFuY2Uuc2hvd1BhZ2VOdW1iZXIgPSBzaG93UGFnZU51bWJlcnM7XHJcbiAgICBub2RlUmVmLmluc3RhbmNlLnRleHQgPSBjb250ZW50O1xyXG4gICAgaWYgKHN0eWxlKSB7XHJcbiAgICAgIG5vZGVSZWYuaW5zdGFuY2UuYXBwbHlTdHlsZShzdHlsZSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEFkZCBub2RlIHRvIGxpc3Qgb2Ygbm9kZXMgYW5kIHVwZGF0ZSBpdHMgaW5kZXggdmFsdWUuXHJcbiAgICB0aGlzLm5vZGVMaXN0LnB1c2gobm9kZVJlZi5pbnN0YW5jZSk7XHJcbiAgICBub2RlUmVmLmluc3RhbmNlLmluZGV4ID0gdGhpcy5maXJzdE9uVG9wID8gMTAwLXRoaXMubm9kZUxpc3QubGVuZ3RoIDogdGhpcy5ub2RlTGlzdC5sZW5ndGg7XHJcblxyXG4gICAgcmV0dXJuIG5vZGVSZWYuaW5zdGFuY2U7XHJcbiAgfVxyXG5cclxuICAvLyBUaWR5IHVwIHN1YnNjcmlwdGlvbnMuXHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICB0aGlzLmZpbmlzaGVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB0aGlzLmhlYWRpbmdDaGFuZ2VkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB0aGlzLm92ZXJGbG93U3Vic2NyaXB0aW9ucy5mb3JFYWNoKHN1YnNjcmlwdGlvbiA9PiB7XHJcbiAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==