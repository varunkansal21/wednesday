/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Injectable, Injector, ComponentFactoryResolver, ViewContainerRef } from '@angular/core';
import { NodeComponent } from './node.component';
import { BehaviorSubject } from 'rxjs';
export class CreateFlowService {
    /**
     * @param {?} injector
     * @param {?} resolver
     */
    constructor(injector, resolver) {
        this.injector = injector;
        this.resolver = resolver;
        this.nodeList = new Array();
        this.firstOnTop = true;
        this.overFlowSubscriptions = [];
        this.nodesSubject = new BehaviorSubject(null);
        this.nodes = /** @type {?} */ (this.nodesSubject);
        this.nodeFactory = this.resolver.resolveComponentFactory(NodeComponent);
        // When all nodes are finished generating, do some housework.
        this.finishedSubscription = NodeComponent.finished.subscribe(() => {
            this.nodeList.forEach(node => node.isVisible = true); // Make all visible once complete.
            // If headings are modified externally, then update sibling nodes to maintain consistent formating.
            this.headingChangedSubscription = NodeComponent.headingChanged.subscribe(() => {
                /** @type {?} */
                let count = 0;
                this.nodeList.forEach(node => {
                    count = node.heading <= ' ' ? count + 1 : count - 1;
                });
                // Loop again to update the visibility of the headings.
                this.nodeList.forEach(node => {
                    node.showHeading = count === this.nodeList.length ? false : true;
                });
            });
            // Make list of nodes available once all are complete.
            this.nodesSubject.next(this.nodeList);
        });
    }
    /**
     * @return {?}
     */
    clearNodes() {
        this.nodeList = [];
    }
    /**
     * @param {?} textPassage
     * @param {?} location
     * @param {?} style
     * @param {?} showPageNumbers
     * @param {?} isOverlaid
     * @return {?}
     */
    createFlow(textPassage, location, style, showPageNumbers, isOverlaid) {
        /** @type {?} */
        let node = this.createNode(textPassage, location, style, showPageNumbers, isOverlaid);
        // Create a new node if there is any overflow text from last node generated.
        // Last node will know when it is the last one, and will
        this.overFlowSubscriptions.push(node.overflow.subscribe(overflowText => {
            if (overflowText) {
                this.createFlow(overflowText, location, style, showPageNumbers, isOverlaid);
            }
        }));
    }
    /**
     * @param {?} content
     * @param {?=} location
     * @param {?=} style
     * @param {?=} showPageNumbers
     * @param {?=} isOverlaid
     * @return {?}
     */
    createNode(content, location, style, showPageNumbers, isOverlaid) {
        /** @type {?} */
        let nodeRef;
        if (location || location instanceof ViewContainerRef) {
            nodeRef = location.createComponent(this.nodeFactory, undefined, this.injector);
        }
        else {
            nodeRef = this.nodeFactory.create(this.injector);
        }
        // Update the node
        nodeRef.instance.isOverlaid = isOverlaid;
        nodeRef.instance.showPageNumber = showPageNumbers;
        nodeRef.instance.text = content;
        if (style) {
            nodeRef.instance.applyStyle(style);
        }
        // Add node to list of nodes and update its index value.
        this.nodeList.push(nodeRef.instance);
        nodeRef.instance.index = this.firstOnTop ? 100 - this.nodeList.length : this.nodeList.length;
        return nodeRef.instance;
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.finishedSubscription.unsubscribe();
        this.headingChangedSubscription.unsubscribe();
        this.overFlowSubscriptions.forEach(subscription => {
            subscription.unsubscribe();
        });
    }
}
CreateFlowService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
CreateFlowService.ctorParameters = () => [
    { type: Injector },
    { type: ComponentFactoryResolver }
];
if (false) {
    /** @type {?} */
    CreateFlowService.prototype.nodeList;
    /** @type {?} */
    CreateFlowService.prototype.nodeFactory;
    /** @type {?} */
    CreateFlowService.prototype.firstOnTop;
    /** @type {?} */
    CreateFlowService.prototype.finishedSubscription;
    /** @type {?} */
    CreateFlowService.prototype.headingChangedSubscription;
    /** @type {?} */
    CreateFlowService.prototype.overFlowSubscriptions;
    /** @type {?} */
    CreateFlowService.prototype.nodesSubject;
    /** @type {?} */
    CreateFlowService.prototype.nodes;
    /** @type {?} */
    CreateFlowService.prototype.injector;
    /** @type {?} */
    CreateFlowService.prototype.resolver;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLWZsb3cuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLXRleHRmbG93LyIsInNvdXJjZXMiOlsibmctdGV4dGZsb3cvY3JlYXRlLWZsb3cuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsd0JBQXdCLEVBQzVCLGdCQUFnQixFQUEyQixNQUFNLGVBQWUsQ0FBQztBQUM1RixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDakQsT0FBTyxFQUFFLGVBQWUsRUFBcUMsTUFBTSxNQUFNLENBQUM7QUFHMUUsTUFBTTs7Ozs7SUFjSixZQUFvQixRQUFrQixFQUFVLFFBQWtDO1FBQTlELGFBQVEsR0FBUixRQUFRLENBQVU7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUEwQjt3QkFiOUMsSUFBSSxLQUFLLEVBQWlCOzBCQUV4QyxJQUFJO3FDQUtzQixFQUFFOzRCQUdELElBQUksZUFBZSxDQUFrQixJQUFJLENBQUM7dUNBQ3RELElBQUksQ0FBQyxZQUEyQztRQUduRixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsdUJBQXVCLENBQUMsYUFBYSxDQUFDLENBQUM7O1FBR3hFLElBQUksQ0FBQyxvQkFBb0IsR0FBSSxhQUFhLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUU7WUFDakUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBRSxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxDQUFDOztZQUd0RCxJQUFJLENBQUMsMEJBQTBCLEdBQUcsYUFBYSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFOztnQkFFNUUsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO2dCQUNkLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUMzQixLQUFLLEdBQUcsSUFBSSxDQUFDLE9BQU8sSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7aUJBQ3JELENBQUMsQ0FBQzs7Z0JBR0gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7b0JBQzNCLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxLQUFLLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztpQkFDbEUsQ0FBQyxDQUFDO2FBQ0osQ0FBQyxDQUFDOztZQUdILElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUN2QyxDQUFDLENBQUM7S0FDSjs7OztJQUVELFVBQVU7UUFDUixJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztLQUNwQjs7Ozs7Ozs7O0lBR0QsVUFBVSxDQUFDLFdBQW1CLEVBQ25CLFFBQTBCLEVBQzFCLEtBQVUsRUFDVixlQUF3QixFQUN4QixVQUFtQjs7UUFFNUIsSUFBSSxJQUFJLEdBQWtCLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUFFLFVBQVUsQ0FBQyxDQUFDOzs7UUFJckcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsRUFBRTtZQUNyRSxFQUFFLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO2dCQUNqQixJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLGVBQWUsRUFBRSxVQUFVLENBQUMsQ0FBQzthQUM3RTtTQUNGLENBQUMsQ0FBQyxDQUFDO0tBQ0w7Ozs7Ozs7OztJQUVPLFVBQVUsQ0FBQyxPQUFlLEVBQ2YsUUFBMkIsRUFDM0IsS0FBVyxFQUFFLGVBQ04sRUFBRSxVQUFvQjs7UUFHOUMsSUFBSSxPQUFPLENBQThCO1FBQ3pDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsSUFBSSxRQUFRLFlBQVksZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1lBQ3JELE9BQU8sR0FBRyxRQUFRLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUNoRjtRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUNsRDs7UUFHRCxPQUFPLENBQUMsUUFBUSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7UUFDekMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxjQUFjLEdBQUcsZUFBZSxDQUFDO1FBQ2xELE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxHQUFHLE9BQU8sQ0FBQztRQUNoQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ1YsT0FBTyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDcEM7O1FBR0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3JDLE9BQU8sQ0FBQyxRQUFRLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFFM0YsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7Ozs7O0lBSTFCLFdBQVc7UUFDVCxJQUFJLENBQUMsb0JBQW9CLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDeEMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQzlDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLEVBQUU7WUFDaEQsWUFBWSxDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQzVCLENBQUMsQ0FBQztLQUNKOzs7WUFsR0YsVUFBVTs7OztZQUxVLFFBQVE7WUFBRSx3QkFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgICBDb21wb25lbnRGYWN0b3J5LCBWaWV3Q29udGFpbmVyUmVmLCBDb21wb25lbnRSZWYsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOb2RlQ29tcG9uZW50IH0gZnJvbSAnLi9ub2RlLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgU3ViamVjdCwgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBDcmVhdGVGbG93U2VydmljZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XHJcbiAgcHJpdmF0ZSBub2RlTGlzdDogTm9kZUNvbXBvbmVudFtdID0gbmV3IEFycmF5PE5vZGVDb21wb25lbnQ+KCk7XHJcbiAgcHJpdmF0ZSBub2RlRmFjdG9yeTogQ29tcG9uZW50RmFjdG9yeTxOb2RlQ29tcG9uZW50PjtcclxuICBmaXJzdE9uVG9wOiBib29sZWFuID0gdHJ1ZTtcclxuXHJcbiAgLy8gU3Vic2NyaXB0aW9uc1xyXG4gIHByaXZhdGUgZmluaXNoZWRTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjsgLy8gRm9yIHdoZW4gdGhlIG5vZGVzIGFyZSBjb21wbGV0ZS5cclxuICBwcml2YXRlIGhlYWRpbmdDaGFuZ2VkU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247IC8vIEZvciB3aGVuIHRoZSBoZWFkaW5nIGlzIGV4dGVybmFsbHkgY2hhbmdlZC5cclxuICBwcml2YXRlIG92ZXJGbG93U3Vic2NyaXB0aW9uczogU3Vic2NyaXB0aW9uW10gPSBbXTsgLy8gRHVyaW5nIGdlbmVyYXRpb24gb2Ygbm9kZXMsIGZpcmVzIHdoZW4gdGhlcmUgYXJlIG1vcmUgbm9kZXMgdG8gZ2VuZXJhdGUuXHJcblxyXG4gIC8vIFByb3ZpZGUgYW4gYXJyYXkgb2Ygbm9kZXMgb25jZSB0aGUgZ2VuZXJhdGlvbiBpcyBjb21wbGV0ZS5cclxuICBwcml2YXRlIG5vZGVzU3ViamVjdDogU3ViamVjdDxOb2RlQ29tcG9uZW50W10+ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxOb2RlQ29tcG9uZW50W10+KG51bGwpO1xyXG4gIG5vZGVzOiBPYnNlcnZhYmxlPE5vZGVDb21wb25lbnRbXT4gPSB0aGlzLm5vZGVzU3ViamVjdCBhcyBPYnNlcnZhYmxlPE5vZGVDb21wb25lbnRbXT47XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIpIHtcclxuICAgIHRoaXMubm9kZUZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KE5vZGVDb21wb25lbnQpO1xyXG4gICAgXHJcbiAgICAvLyBXaGVuIGFsbCBub2RlcyBhcmUgZmluaXNoZWQgZ2VuZXJhdGluZywgZG8gc29tZSBob3VzZXdvcmsuXHJcbiAgICB0aGlzLmZpbmlzaGVkU3Vic2NyaXB0aW9uID0gIE5vZGVDb21wb25lbnQuZmluaXNoZWQuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgdGhpcy5ub2RlTGlzdC5mb3JFYWNoKG5vZGUgPT4gIG5vZGUuaXNWaXNpYmxlID0gdHJ1ZSk7IC8vIE1ha2UgYWxsIHZpc2libGUgb25jZSBjb21wbGV0ZS5cclxuXHJcbiAgICAgIC8vIElmIGhlYWRpbmdzIGFyZSBtb2RpZmllZCBleHRlcm5hbGx5LCB0aGVuIHVwZGF0ZSBzaWJsaW5nIG5vZGVzIHRvIG1haW50YWluIGNvbnNpc3RlbnQgZm9ybWF0aW5nLlxyXG4gICAgICB0aGlzLmhlYWRpbmdDaGFuZ2VkU3Vic2NyaXB0aW9uID0gTm9kZUNvbXBvbmVudC5oZWFkaW5nQ2hhbmdlZC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgIC8vIExvb3Agb25jZSB0byBzZWUgaWYgYWxsIGFyZSBlbXB0eS5cclxuICAgICAgICBsZXQgY291bnQgPSAwO1xyXG4gICAgICAgIHRoaXMubm9kZUxpc3QuZm9yRWFjaChub2RlID0+IHsgXHJcbiAgICAgICAgICBjb3VudCA9IG5vZGUuaGVhZGluZyA8PSAnICcgPyBjb3VudCArIDEgOiBjb3VudCAtIDE7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIExvb3AgYWdhaW4gdG8gdXBkYXRlIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBoZWFkaW5ncy5cclxuICAgICAgICB0aGlzLm5vZGVMaXN0LmZvckVhY2gobm9kZSA9PiB7XHJcbiAgICAgICAgICBub2RlLnNob3dIZWFkaW5nID0gY291bnQgPT09IHRoaXMubm9kZUxpc3QubGVuZ3RoID8gZmFsc2UgOiB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIE1ha2UgbGlzdCBvZiBub2RlcyBhdmFpbGFibGUgb25jZSBhbGwgYXJlIGNvbXBsZXRlLlxyXG4gICAgICB0aGlzLm5vZGVzU3ViamVjdC5uZXh0KHRoaXMubm9kZUxpc3QpO1xyXG4gICAgfSk7XHJcbiAgfSBcclxuXHJcbiAgY2xlYXJOb2RlcygpIHtcclxuICAgIHRoaXMubm9kZUxpc3QgPSBbXTtcclxuICB9XHJcblxyXG4gIC8vIFRoaXMgd2lsbCBraWNrIG9mZiBhIHByb2Nlc3MgdGhhdCBnZW5lcmF0ZXMgYSBub2RlIGV2ZXJ5IHRpbWUgYSBnZW5lcmF0ZWQgbm9kZSBpcyB0b28gZnVsbCBhbmQgb3ZlcmZsb3dzIHdpdGggdGV4dC5cclxuICBjcmVhdGVGbG93KHRleHRQYXNzYWdlOiBzdHJpbmcsIFxyXG4gICAgICAgICAgICAgbG9jYXRpb246IFZpZXdDb250YWluZXJSZWYsIFxyXG4gICAgICAgICAgICAgc3R5bGU6IGFueSwgXHJcbiAgICAgICAgICAgICBzaG93UGFnZU51bWJlcnM6IGJvb2xlYW4sIFxyXG4gICAgICAgICAgICAgaXNPdmVybGFpZDogYm9vbGVhbikge1xyXG5cclxuICAgIGxldCBub2RlOiBOb2RlQ29tcG9uZW50ID0gdGhpcy5jcmVhdGVOb2RlKHRleHRQYXNzYWdlLCBsb2NhdGlvbiwgc3R5bGUsIHNob3dQYWdlTnVtYmVycywgaXNPdmVybGFpZCk7XHJcbiAgICBcclxuICAgIC8vIENyZWF0ZSBhIG5ldyBub2RlIGlmIHRoZXJlIGlzIGFueSBvdmVyZmxvdyB0ZXh0IGZyb20gbGFzdCBub2RlIGdlbmVyYXRlZC5cclxuICAgIC8vIExhc3Qgbm9kZSB3aWxsIGtub3cgd2hlbiBpdCBpcyB0aGUgbGFzdCBvbmUsIGFuZCB3aWxsIFxyXG4gICAgdGhpcy5vdmVyRmxvd1N1YnNjcmlwdGlvbnMucHVzaChub2RlLm92ZXJmbG93LnN1YnNjcmliZShvdmVyZmxvd1RleHQgPT4ge1xyXG4gICAgICBpZiAob3ZlcmZsb3dUZXh0KSB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVGbG93KG92ZXJmbG93VGV4dCwgbG9jYXRpb24sIHN0eWxlLCBzaG93UGFnZU51bWJlcnMsIGlzT3ZlcmxhaWQpO1xyXG4gICAgICB9XHJcbiAgICB9KSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZU5vZGUoY29udGVudDogc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbj86IFZpZXdDb250YWluZXJSZWYsIFxyXG4gICAgICAgICAgICAgICAgICAgICBzdHlsZT86IGFueSwgc2hvd1BhZ2VOdW1iZXJzPzogXHJcbiAgICAgICAgICAgICAgICAgICAgIGJvb2xlYW4sIGlzT3ZlcmxhaWQ/OiBib29sZWFuKTogTm9kZUNvbXBvbmVudCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAvLyBHZW5lcmF0ZSB0aGUgbm9kZSB3aXRoIHRoZSBub2RlRmFjdG9yeS5cclxuICAgIGxldCBub2RlUmVmOiBDb21wb25lbnRSZWY8Tm9kZUNvbXBvbmVudD47XHJcbiAgICBpZiAobG9jYXRpb24gfHwgbG9jYXRpb24gaW5zdGFuY2VvZiBWaWV3Q29udGFpbmVyUmVmKSB7XHJcbiAgICAgIG5vZGVSZWYgPSBsb2NhdGlvbi5jcmVhdGVDb21wb25lbnQodGhpcy5ub2RlRmFjdG9yeSwgdW5kZWZpbmVkLCB0aGlzLmluamVjdG9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG5vZGVSZWYgPSB0aGlzLm5vZGVGYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gVXBkYXRlIHRoZSBub2RlXHJcbiAgICBub2RlUmVmLmluc3RhbmNlLmlzT3ZlcmxhaWQgPSBpc092ZXJsYWlkO1xyXG4gICAgbm9kZVJlZi5pbnN0YW5jZS5zaG93UGFnZU51bWJlciA9IHNob3dQYWdlTnVtYmVycztcclxuICAgIG5vZGVSZWYuaW5zdGFuY2UudGV4dCA9IGNvbnRlbnQ7XHJcbiAgICBpZiAoc3R5bGUpIHtcclxuICAgICAgbm9kZVJlZi5pbnN0YW5jZS5hcHBseVN0eWxlKHN0eWxlKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gQWRkIG5vZGUgdG8gbGlzdCBvZiBub2RlcyBhbmQgdXBkYXRlIGl0cyBpbmRleCB2YWx1ZS5cclxuICAgIHRoaXMubm9kZUxpc3QucHVzaChub2RlUmVmLmluc3RhbmNlKTtcclxuICAgIG5vZGVSZWYuaW5zdGFuY2UuaW5kZXggPSB0aGlzLmZpcnN0T25Ub3AgPyAxMDAtdGhpcy5ub2RlTGlzdC5sZW5ndGggOiB0aGlzLm5vZGVMaXN0Lmxlbmd0aDtcclxuXHJcbiAgICByZXR1cm4gbm9kZVJlZi5pbnN0YW5jZTtcclxuICB9XHJcblxyXG4gIC8vIFRpZHkgdXAgc3Vic2NyaXB0aW9ucy5cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMuZmluaXNoZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgIHRoaXMuaGVhZGluZ0NoYW5nZWRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgIHRoaXMub3ZlckZsb3dTdWJzY3JpcHRpb25zLmZvckVhY2goc3Vic2NyaXB0aW9uID0+IHtcclxuICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl19